{% extends 'layout.html' %}

{% block title %}Configurations{% endblock %}

{% block content %}
    <div class="container">
        <h1>Configurations</h1>
        {% for config in configs %}
            {% if config[2] == 1 %}
            <div class="row">
                <div class="col-md-5">
                    <label for="{{ config_name_to_id(config[0]) }}" class="form-label col-md-8">{{ config[0] }}</label>
                    <span id="{{ config_name_to_id(config[0]) }}-alert" class="d-none"></span>
                    <div class="input-group mb-3 col-md">
                        <input type="{{ config[3] }}" class="form-control" id="{{ config_name_to_id(config[0]) }}" name="{{ config_name_to_id(config[0]) }}" value="{{ config[1] }}">
                        <button class="input-group-text bg-primary">Update</button>
                    </div>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
    <script>
        function updateConfig(config, value) {
            return new Promise(function(resolve, reject) {
                $.ajax({
                    type: "POST",
                    url: "/configs",
                    data: {
                        config: config,
                        value: value
                    },
                    success: function (result) {
                        resolve(result);
                    },
                    error: function (result) {
                        reject(result);
                    }
                });
            })
        }
    </script>
    {% for config in configs %}
        {% if config[2] == 1 %}
            <script>
                $("#{{ config_name_to_id(config[0]) }}").click(function() {
                    updateConfig("{{ config_name_to_id(config[0]) }}", $("#{{ config_name_to_id(config[0]) }}").val()).then(function(result) {
                        $("#{{ config_name_to_id(config[0]) }}-alert").text(result);
                        $("#{{ config_name_to_id(config[0]) }}-alert").removeClass("d-none");
                        $("#{{ config_name_to_id(config[0]) }}-alert").addClass("text-success");
                        $("#{{ config_name_to_id(config[0]) }}-alert").val("Update Successful!");
                        setTimeout(function() {
                            $("#{{ config_name_to_id(config[0]) }}-alert").addClass("d-none");
                            $("#{{ config_name_to_id(config[0]) }}-alert").removeClass("text-success");
                            $("#{{ config_name_to_id(config[0]) }}-alert").val("");
                        }, 5000);
                    }).catch(function(result) {
                        $("#{{ config_name_to_id(config[0]) }}-alert").text(result);
                        $("#{{ config_name_to_id(config[0]) }}-alert").removeClass("d-none");
                        $("#{{ config_name_to_id(config[0]) }}-alert").addClass("text-danger");
                        $("#{{ config_name_to_id(config[0]) }}-alert").val("Update Failed!");
                        setTimeout(function() {
                            $("#{{ config_name_to_id(config[0]) }}-alert").addClass("d-none");
                            $("#{{ config_name_to_id(config[0]) }}-alert").removeClass("text-danger");
                            $("#{{ config_name_to_id(config[0]) }}-alert").val("");
                        }, 5000);
                    });
                });
            </script>
        {% endif %}
    {% endfor %}
{% endblock %}